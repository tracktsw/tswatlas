@tailwind base;
@tailwind components;
@tailwind utilities;

/* Safe area and iOS-specific offsets */
:root {
  --safe-top: max(env(safe-area-inset-top, 0px), constant(safe-area-inset-top, 0px));
  --safe-bottom: max(env(safe-area-inset-bottom, 0px), constant(safe-area-inset-bottom, 0px));
  --ios-header-extra: 16px;
}

/* iOS-only: push header down significantly to clear Dynamic Island */
@supports (-webkit-touch-callout: none) {
  :root {
    --ios-header-extra: 56px;
  }
}

@layer base {
  :root {
    /* 
     * TrackTSW Refined Palette
     * Emotionally supportive, accessible, and mature
     * 
     * COLOR USAGE RULES:
     * --anchor: Key metrics (days healing), streaks, milestones, primary headings
     * --action: User actions ONLY (check-ins, uploads, primary CTAs) - never decorative
     * --sage: Healing/stable states, secondary elements
     * --cream/muted: Backgrounds, neutral states
     * --flare: High-symptom/flare indicators (used sparingly)
     */
    
    /* Foundation - warm cream base */
    --background: 40 35% 96%;
    --foreground: 24 18% 16%;
    
    /* Cards with subtle hierarchy */
    --card: 42 30% 94%;
    --card-foreground: 24 18% 16%;
    --card-elevated: 44 28% 91%;
    
    --popover: 42 30% 94%;
    --popover-foreground: 24 18% 16%;
    
    /* Anchor color - Deep Forest Green for key metrics & headings */
    --anchor: 158 32% 28%;
    --anchor-foreground: 40 50% 98%;
    
    /* Primary - Sage for healing states */
    --primary: 152 24% 44%;
    --primary-foreground: 40 50% 98%;
    
    /* Secondary - Muted sage */
    --secondary: 150 16% 85%;
    --secondary-foreground: 152 28% 30%;
    
    /* Muted elements */
    --muted: 38 22% 88%;
    --muted-foreground: 24 12% 44%;
    
    /* Action color - Warm terracotta for CTAs ONLY */
    --action: 16 58% 52%;
    --action-foreground: 40 50% 98%;
    
    /* Gold color - for upgrade/premium CTAs */
    --gold: 38 75% 55%;
    --gold-foreground: 24 20% 12%;
    
    /* Accent - reserved for subtle highlights */
    --accent: 32 45% 75%;
    --accent-foreground: 24 20% 20%;
    
    /* Destructive */
    --destructive: 4 68% 52%;
    --destructive-foreground: 0 0% 98%;
    
    /* Borders and inputs */
    --border: 36 18% 82%;
    --input: 36 18% 82%;
    --ring: 152 24% 44%;
    
    --radius: 1rem;
    
    /* Semantic tokens */
    --sage: 152 24% 44%;
    --sage-light: 150 18% 90%;
    --sage-deep: 158 32% 28%;
    
    --cream: 40 35% 96%;
    --cream-dark: 38 28% 88%;
    
    /* Flare state - cooler, muted */
    --flare: 220 18% 48%;
    --flare-light: 220 14% 90%;
    
    /* Stable/healing state - warmer */
    --healing: 32 38% 55%;
    --healing-light: 38 35% 92%;
    
    /* Warm gray for body text */
    --warm-gray: 24 10% 46%;
    
    /* Progress & streaks - uses anchor */
    --progress: 158 32% 28%;
    --streak: 24 55% 42%;
    
    /* Shadows */
    --shadow-warm: 24 25% 25%;
    
    /* Sidebar */
    --sidebar-background: 42 30% 94%;
    --sidebar-foreground: 24 18% 16%;
    --sidebar-primary: 152 24% 44%;
    --sidebar-primary-foreground: 40 50% 98%;
    --sidebar-accent: 150 16% 85%;
    --sidebar-accent-foreground: 152 28% 30%;
    --sidebar-border: 36 18% 82%;
    --sidebar-ring: 152 24% 44%;
  }

  .dark {
    --background: 24 16% 9%;
    --foreground: 40 22% 90%;
    
    --card: 24 14% 12%;
    --card-foreground: 40 22% 90%;
    --card-elevated: 24 12% 15%;
    
    --popover: 24 14% 12%;
    --popover-foreground: 40 22% 90%;
    
    --anchor: 155 28% 52%;
    --anchor-foreground: 24 16% 9%;
    
    --primary: 152 26% 48%;
    --primary-foreground: 24 16% 9%;
    
    --secondary: 24 12% 18%;
    --secondary-foreground: 40 20% 85%;
    
    --muted: 24 10% 16%;
    --muted-foreground: 38 14% 58%;
    
    --action: 18 52% 55%;
    --action-foreground: 40 50% 98%;
    
    /* Gold color - for upgrade/premium CTAs */
    --gold: 42 70% 50%;
    --gold-foreground: 24 20% 12%;
    
    --accent: 32 35% 45%;
    --accent-foreground: 40 22% 92%;
    
    --destructive: 4 58% 48%;
    --destructive-foreground: 0 0% 98%;
    
    --border: 24 12% 20%;
    --input: 24 12% 20%;
    --ring: 152 26% 48%;
    
    --sage: 152 26% 48%;
    --sage-light: 24 12% 18%;
    --sage-deep: 155 28% 52%;
    
    --cream: 24 12% 12%;
    --cream-dark: 24 10% 16%;
    
    --flare: 218 16% 55%;
    --flare-light: 220 12% 22%;
    
    --healing: 32 32% 50%;
    --healing-light: 30 20% 20%;
    
    --warm-gray: 24 8% 52%;
    
    --progress: 155 28% 52%;
    --streak: 24 48% 50%;
    
    --shadow-warm: 24 18% 6%;
    
    --sidebar-background: 24 14% 12%;
    --sidebar-foreground: 40 22% 90%;
    --sidebar-primary: 152 26% 48%;
    --sidebar-primary-foreground: 24 16% 9%;
    --sidebar-accent: 24 12% 18%;
    --sidebar-accent-foreground: 40 20% 85%;
    --sidebar-border: 24 12% 20%;
    --sidebar-ring: 152 26% 48%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  
  body {
    @apply bg-background text-foreground antialiased;
    font-feature-settings: "rlig" 1, "calt" 1;
    /* Simplified, calmer background - subtle dot pattern instead of noise */
    background-image: 
      radial-gradient(ellipse at 20% 0%, hsl(var(--sage-light) / 0.3) 0%, transparent 45%),
      radial-gradient(ellipse at 80% 100%, hsl(var(--cream-dark) / 0.4) 0%, transparent 45%);
    background-size: 100% 100%;
    background-attachment: fixed;
  }
  
  /* iOS: Disable fixed background to prevent keyboard scroll issues */
  html.ios body {
    background-attachment: scroll;
  }
  
  html {
    scroll-behavior: smooth;
  }
  
  h1, h2, h3, h4, h5, h6 {
    font-family: "Quicksand", system-ui, sans-serif;
    @apply tracking-tight;
  }
  
  /* Anchor headings for key content */
  .heading-anchor {
    font-family: "Quicksand", system-ui, sans-serif;
    @apply text-anchor font-bold;
  }
}

@layer components {
  /* Standard card */
  .glass-card {
    @apply bg-card/95 backdrop-blur-sm border border-border/50 rounded-2xl;
    box-shadow: 
      0 2px 12px -3px hsl(var(--shadow-warm) / 0.06),
      0 1px 2px hsl(var(--shadow-warm) / 0.03);
  }
  
  /* Elevated card for progress/metrics */
  .glass-card-elevated {
    @apply bg-card backdrop-blur-sm border border-border/60 rounded-2xl;
    box-shadow: 
      0 4px 16px -4px hsl(var(--shadow-warm) / 0.1),
      0 2px 4px hsl(var(--shadow-warm) / 0.04),
      inset 0 1px 0 hsl(40 50% 98% / 0.4);
  }
  
  /* Legacy alias */
  .glass-card-warm {
    @apply glass-card-elevated;
  }
  
  /* Progress/milestone card */
  .progress-card {
    @apply bg-gradient-to-br from-card via-card to-sage-light/30 backdrop-blur-sm border border-sage/20 rounded-2xl;
    box-shadow: 
      0 4px 20px -6px hsl(var(--sage) / 0.12),
      0 2px 4px hsl(var(--shadow-warm) / 0.04);
  }
  
  /* Flare state card - cooler tones */
  .flare-card {
    @apply bg-gradient-to-br from-flare-light to-card border border-flare/15 rounded-2xl;
    box-shadow: 0 2px 12px -3px hsl(var(--flare) / 0.08);
  }
  
  /* Healing state card - warmer tones */
  .healing-card {
    @apply bg-gradient-to-br from-healing-light to-card border border-healing/15 rounded-2xl;
    box-shadow: 0 2px 12px -3px hsl(var(--healing) / 0.1);
  }
  
  /* Subtle decorative patterns */
  .decorative-dots {
    background-image: radial-gradient(hsl(var(--sage) / 0.08) 1px, transparent 1px);
    background-size: 16px 16px;
  }
  
  .decorative-lines {
    background-image: repeating-linear-gradient(
      90deg,
      hsl(var(--border) / 0.3) 0px,
      hsl(var(--border) / 0.3) 1px,
      transparent 1px,
      transparent 24px
    );
  }
  
  /* Action button - for CTAs only */
  .btn-action {
    @apply bg-action text-action-foreground font-semibold;
    box-shadow: 0 2px 8px -2px hsl(var(--action) / 0.35);
    transition: all 0.2s ease;
  }
  
  .btn-action:hover {
    box-shadow: 0 4px 12px -2px hsl(var(--action) / 0.4);
    transform: translateY(-1px);
  }
  
  /* Legacy warm button */
  .btn-warm {
    @apply btn-action;
  }
  
  /* Metric/stat display */
  .metric-value {
    @apply text-anchor font-bold;
  }
  
  .metric-label {
    @apply text-muted-foreground text-xs font-medium;
  }
  
  /* Streak indicator */
  .streak-badge {
    @apply bg-gradient-to-r from-streak/15 to-streak/5 text-streak font-semibold rounded-full px-3 py-1 text-sm;
  }
  
  /* Decorative blob - reduced opacity */
  .decorative-blob {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.2;
    pointer-events: none;
  }
}

@layer utilities {
  .animate-fade-in {
    animation: fadeIn 0.4s ease-out forwards;
  }
  
  .animate-slide-up {
    animation: slideUp 0.4s ease-out forwards;
  }
  
  .animate-scale-in {
    animation: scaleIn 0.3s ease-out forwards;
  }
  
  .animate-float {
    animation: float 6s ease-in-out infinite;
  }
  
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  
  .text-warm-shadow {
    text-shadow: 0 2px 10px hsl(var(--shadow-warm) / 0.1);
  }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from { 
    opacity: 0;
    transform: translateY(12px);
  }
  to { 
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes scaleIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes float {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-8px);
  }
}

@keyframes sparkle-float {
  0% {
    opacity: 1;
    transform: translateY(0) scale(1) rotate(0deg);
  }
  50% {
    opacity: 0.8;
    transform: translateY(-40px) scale(1.2) rotate(180deg);
  }
  100% {
    opacity: 0;
    transform: translateY(-80px) scale(0.5) rotate(360deg);
  }
}

@keyframes sparkle-burst {
  0% {
    opacity: 1;
    transform: scale(0) rotate(0deg);
  }
  50% {
    opacity: 1;
    transform: scale(1.5) rotate(180deg);
  }
  100% {
    opacity: 0;
    transform: scale(0.8) rotate(360deg) translateY(-30px);
  }
}

@keyframes sparkle-pop {
  0% {
    opacity: 1;
    transform: scale(0);
  }
  40% {
    opacity: 1;
    transform: scale(1.4);
  }
  100% {
    opacity: 0;
    transform: scale(0.5) translateY(-50px);
  }
}

@keyframes shimmer {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

@layer utilities {
  .animate-sparkle-float {
    animation: sparkle-float var(--duration, 1s) ease-out forwards;
  }
  
  .animate-sparkle-burst {
    animation: sparkle-burst var(--duration, 1s) ease-out forwards;
  }
  
  .animate-sparkle-pop {
    animation: sparkle-pop var(--duration, 1s) ease-out forwards;
  }
  
  .animate-shimmer {
    animation: shimmer 1.5s ease-in-out infinite;
  }

  /* Safe area padding for iOS devices */
  .safe-area-inset-bottom {
    padding-bottom: env(safe-area-inset-bottom, 0px);
  }
  
  .safe-area-inset-top {
    padding-top: env(safe-area-inset-top, 0px);
  }
}
